<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>OrderController.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">Ecommerce Platform Project</a> &gt; <a href="index.source.html" class="el_package">com.example.controller</a> &gt; <span class="el_source">OrderController.java</span></div><h1>OrderController.java</h1><pre class="source lang-java linenums">package com.example.controller;

import com.example.dto.OrderInfoDTO;
import com.example.entity.Order;
import com.example.entity.OrderItem;
import com.example.entity.Product;
import com.example.entity.Customer;
import com.example.entity.User;
import com.example.service.OrderService;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.web.bind.annotation.*;
import io.swagger.v3.oas.annotations.Operation;
import io.swagger.v3.oas.annotations.responses.ApiResponse;
import io.swagger.v3.oas.annotations.responses.ApiResponses;

import java.util.List;
import java.util.stream.Collectors;

@RestController
@RequestMapping(&quot;/api/v1/orders&quot;)
public class OrderController {
    private final OrderService orderService;

    @Autowired
<span class="fc" id="L25">    public OrderController(OrderService orderService) {</span>
<span class="fc" id="L26">        this.orderService = orderService;</span>
<span class="fc" id="L27">    }</span>

    @Operation(summary = &quot;Get orders by status&quot;, description = &quot;Retrieve all orders with a specific status.&quot;)
    @ApiResponses(value = {
            @ApiResponse(responseCode = &quot;200&quot;, description = &quot;List of orders with the given status returned successfully&quot;)
    })
    @GetMapping(&quot;/status/{status}&quot;)
    public List&lt;OrderInfoDTO&gt; getOrdersByStatus(@PathVariable String status) {
<span class="nc" id="L35">        List&lt;Order&gt; orders = orderService.getOrdersByStatus(status);</span>
<span class="nc" id="L36">        return orders.stream().map(this::toOrderInfoDTO).collect(Collectors.toList());</span>
    }

    @Operation(summary = &quot;Get all orders&quot;, description = &quot;Retrieve a list of all orders with user and product details.&quot;)
    @ApiResponses(value = {
            @ApiResponse(responseCode = &quot;200&quot;, description = &quot;List of orders returned successfully&quot;)
    })
    @GetMapping
    public List&lt;OrderInfoDTO&gt; getAllOrders() {
<span class="nc" id="L45">        List&lt;Order&gt; orders = orderService.getAllOrders();</span>
<span class="nc" id="L46">        return orders.stream().map(this::toOrderInfoDTO).collect(Collectors.toList());</span>
    }

    @Operation(summary = &quot;Get order by ID&quot;, description = &quot;Retrieve order details by order ID.&quot;)
    @ApiResponses(value = {
            @ApiResponse(responseCode = &quot;200&quot;, description = &quot;Order found and returned successfully&quot;),
            @ApiResponse(responseCode = &quot;404&quot;, description = &quot;Order not found&quot;)
    })
    @GetMapping(&quot;/{id}&quot;)
    public OrderInfoDTO getOrderById(@PathVariable Long id) {
<span class="nc" id="L56">        Order order = orderService.getOrderById(id);</span>
<span class="nc" id="L57">        return toOrderInfoDTO(order);</span>
    }

    @Operation(summary = &quot;Get orders by user name&quot;, description = &quot;Retrieve all orders made by a specific user name.&quot;)
    @ApiResponses(value = {
            @ApiResponse(responseCode = &quot;200&quot;, description = &quot;List of user's orders returned successfully&quot;)
    })
    @GetMapping(&quot;/user/name/{userName}&quot;)
    public List&lt;OrderInfoDTO&gt; getOrdersByUser(@PathVariable String userName) {
<span class="nc" id="L66">        List&lt;Order&gt; orders = orderService.getOrdersByUserName(userName);</span>
<span class="nc" id="L67">        return orders.stream().map(this::toOrderInfoDTO).collect(Collectors.toList());</span>
    }


    @Operation(summary = &quot;Place a new order&quot;, description = &quot;Create a new order for a customer by a user with a list of order items.&quot;)
    @ApiResponses(value = {
            @ApiResponse(responseCode = &quot;201&quot;, description = &quot;Order placed successfully&quot;),
            @ApiResponse(responseCode = &quot;400&quot;, description = &quot;Invalid input&quot;)
    })
    @PostMapping
    public OrderInfoDTO placeOrder(@RequestParam Long userId, @RequestParam Long customerId, @RequestBody List&lt;com.example.dto.OrderItemDTO&gt; items) {
<span class="nc" id="L78">        Order order = orderService.placeOrder(userId, customerId, items);</span>
<span class="nc" id="L79">        return toOrderInfoDTO(order);</span>
    }

    private OrderInfoDTO toOrderInfoDTO(Order order) {
<span class="nc bnc" id="L83" title="All 2 branches missed.">        if (order == null)</span>
<span class="nc" id="L84">            return null;</span>
<span class="nc" id="L85">        Customer customer = order.getCustomer();</span>
<span class="nc" id="L86">        User user = order.getUser();</span>
<span class="nc" id="L87">        List&lt;OrderInfoDTO.ProductInfo&gt; products = order.getItems().stream().map(this::toProductInfo)</span>
<span class="nc" id="L88">                .collect(Collectors.toList());</span>
<span class="nc" id="L89">        return new OrderInfoDTO(</span>
<span class="nc" id="L90">                order.getId(),</span>
<span class="nc bnc" id="L91" title="All 2 branches missed.">                customer != null ? customer.getName() : null,</span>
<span class="nc bnc" id="L92" title="All 2 branches missed.">                customer != null ? customer.getEmail() : null,</span>
<span class="nc bnc" id="L93" title="All 2 branches missed.">                user != null ? user.getName() : null, // This is the person who placed the order</span>
<span class="nc" id="L94">                order.getTotalAmount(),</span>
<span class="nc" id="L95">                order.getStatus(),</span>
                products);
    }

    private OrderInfoDTO.ProductInfo toProductInfo(OrderItem item) {
<span class="nc" id="L100">        Product product = item.getProduct();</span>
<span class="nc" id="L101">        return new OrderInfoDTO.ProductInfo(</span>
<span class="nc" id="L102">                product.getId(),</span>
<span class="nc" id="L103">                product.getName(),</span>
<span class="nc bnc" id="L104" title="All 2 branches missed.">                product.getCategory() != null ? product.getCategory().getName() : null,</span>
<span class="nc" id="L105">                item.getQuantity(),</span>
<span class="nc bnc" id="L106" title="All 2 branches missed.">                item.getPrice() != null ? item.getPrice().toString() : null);</span>
    }
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.12.202403310830</span></div></body></html>